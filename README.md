# FACT
The official code implementation for *Feature Aggregation and Convolution with Transformers* (FACT) from our paper, "FACT: Feature Aggregation and Convolution with Transformers for predicting drug classification code".

# Model description
![FACT](https://github.com/knhc1234/FACT/blob/main/Framework.png)

**(a)** First, it generates three drug similarity matrices based on drug fingerprints, drug-drug interactions, and side effects. 

**(b)** Next, an ATC similarity matrix is constructed by incorporating hierarchical weights and applying masking to drug-ATC code associations for the test and target pairs. The feature matrix for the target pair is generated by aggregating features containing relevant information. 

**(c)** Each matrix is then transformed into its final embedding through the CT encoder, which includes convolution, TR blocks, and average pooling. 

**(d)** The three embeddings are then processed through a fully connected layer, followed by a sigmoid layer to predict the drug’s ATC code.

# Requirements

- `python`=3.9
- `pytorch`=2.1.0
- `numpy`=1.26.3
- `tqdm`=4.67.1
- `scikit-learn`=1.6.1
- `networkx`=3.2.1
  
# Virtual Environment Setup (using anaconda)

```
conda create -n FACT python=3.9
conda activate FACT
conda install pytorch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 pytorch-cuda=12.1 -c pytorch -c nvidia
pip install -r requirements.txt
```

# Running code example

### 1. Unzip the following files in the "/FACT/data/" directory:
- chemical_similarity_matrix.txt.gz → chemical_similarity_matrix.txt
- drug_interaction_matrix.txt.gz → drug_interaction_matrix.txt
- sideEffect_association_matrix.txt.gz → sideEffect_association_matrix.txt

### 2. Check the config file("/FACT/configs/FACT.yaml) to set the ATC level for prediction and configure the model hyperparameters.
The hyperparameters are defined as follows:
- level: Specifies the ATC code level to be predicted (1-4).
- generate_new_negative_target: Determines whether to generate new negative samples or use existing data (True/False).
- epochs: Number of training epochs.
- early_stopping_count: Criterion for applying early stopping.
- batch_size: Batch size.
- num_layers: Number of Transformer blocks in the CT Encoder.
- tr_hidden: CNN output dimension and Transformer's hidden dimension.
- num_head: Number of attention heads.
- ff_weight: Ratio for the feed-forward neural network dimension in the Transformer.
- dropout: Dropout rate.
- learning_rate: Learning rate for model optimization.
- adj_paths:  Specifies the paths to the three drug similarity matrices. 

### 3. Move to the "/FACT/examples/" directory and run main.py to start training.
```
python main.py
```

### 4. The predicted results for each fold will be saved in the "/FACT/result/level{predicted level}/" directory.
